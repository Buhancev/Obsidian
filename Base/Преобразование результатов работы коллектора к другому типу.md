2022-10-0412:51
Tags: #Java #JavaCoreAdvanced  #StreamAPI 

__
# Преобразование результатов работы коллектора к другому типу

## collectingAndThen
Так как оберываение в тип Optional не имеет никакой пользы, стоит избавиться от этого.
Для этого можно воспользоваться фабричным методом Collectors.collectingAndThen
```java
Map<Dish.Type, Dish> mostCaloricByType 
	= menu.stream()
		  .collect(groupingBy(Dish::getType,//функция классификации
			  collectingAndThen(
				  maxBy(comparingInt(Dish::getCalories)),//обернутый коллектор
					  Optional::get)));//преобразующая функция
```
Этот фабричный метод принимает два аргумента - обертываемый коллектор и преобразующую функцию. 
Данный дополнительный коллектор служит адапатером для предыдущего коллектора и отображает возвращаемое значение с помощью преобразующей функции в качестве последнего шага операции collect. 

В данном случае обертывается созданный с помощью операции maxBy коллектор,  а функция преобразования, Optional::get, извлекает содержащееся в возвращенном объекте Optional значение. 
Это можно сделать без описки, так как коллектор reducing никогда не возвращает Optional.empty()

В результате получаем
```java
{FISH=salmon, OTHER=pizza, MEAT=pork}
```

#### Несколько вложенных коллекторов - распространенная практика, причем способ их взаимодействия не всегда очевиден

Схема выполнения примера
![[Комбинируем взаимодействие нескольких коллекторов за счет сложения одного в другой.png]]
- Коллекторы обозначены штриховыми линиями. Внешний groupingBy разбивает (группирует) потьок блюд на три подпотока, по различным типам
- Коллектор groupingBy служит адаптером для коллектора collectingAndThen, и каждый подпоток, получившийся в результате операции группировки, подвергается дальнейшес свертке этим вторым коллектором
- Коллектор collectingAndThen служит оберткой для третьего коллектора, maxBy
- Далее операция свертки подпотоков выполняется коллектором свертки, но включающий её коллектор collectingAndThen применяет к её результату преобразующую функцию Optional::get
- Три преобразованные значения - наиболее калорийные блюда в своих типа

__
### Zero-Links
- [[Сбор данных потока данных в подгруппы]]


__
### Links
- 

