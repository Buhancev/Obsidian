2022-10-2220:04
Tags: #Java #JavaCoreAdvanced #CollectionAPI 
__
# ConcurrentHashMap
Поддерживает три новые операции, напоминающие операции с потоками данных
- forEach - выполняет заданное действие для каждой пары (ключ; значение)
- reduce - объединяет все пары в единый результат с помощью заданной функции свертки
- search - применяет функцию к каждой паре, пока не будет получен непустой результат.

### Каждый из этих видов операций существует в четырех формах, принимающих функции с ключами, значениями, объектами Map.Entry и парами в качестве аргументов
- работающие с ключами и значениями (forEach, reduce, search)
- работающие с ключами (forEachKey, reduceKey, searchKey)
- работающие со значениями (forEachValue, reduceValue, searchValue)
- работающие с объектами Map.Entry (forEachEntries, reduceEntries, searchEntries)

Обратите внимание, что эти операции не блокируют состояние объекта ConcurrentHashMap; они работают с отдельными элементами по мере обхода. Передаваемые в эти операции функции не зависят от какого-либо упорядочивания, каких-либо других объектов или значений, которые могут поменяться за время вычислений.

Кроме того, для всех этих операций необходимо указывать пороговое значения распараллеливания. Если текущий размер ассоциативного массива меньше заданного порогового значения, эти операции будут выполняться последовательно. Порогое значение 1 означает максимальный параллелизм на основе общего пула потоков выполнения. Пороговое значение, равное Long.MAX_VALUE, означает выполнение операции в одном потоке выполнения. Обычно имеет смысл придерживаться этих значений, разве что архитектура вашего приложения включает расширенную оптимизацию.

Например, найдем максимальное значение ассоциативного массива
```java
ConcurrentHashMap<String, Long> map = new ConcurrentHashMap<>();
long parallelismThreshold = 1;
Optional<Integer> maxValue = 
	Optional.ofNullable(map.reduce(parallelismThreshold, Long::max));
```
Стоит обратить внимание на существование специализированных версий простых типаов данных (int, long, double) для всех операций свертки (reduceValuesToInt, reduceKeyToLong и тд) - более эффективных благодаря отсутсвию упаковки.
__
### Zero-Links
- [[Усовершенствованный класс ConcurrentHashMap]]

__
### Links
- 

