2022-09-2623:54
Tags: #Java #JavaCoreAdvanced #StreamAPI 

__
# Свертка
Это когда поток данных преобразуется в одно значение (сумма и тд).

## Суммирование элементов

Вот так происходит суммирование внешним циклом for-each
```java
int sum = 0;
for(int x = numbers) {
	sum += x;
}
```
Для получение результата все элементы списка numbers группируются с помощью операции сложения. Иначе говоря, массив *сворачивают* в сумму всех элементов массива, посредством многократного сложения.
В коде два параметра:
- исходное значение переменной sum (0 в данном случае)
- операции группировки элементов списка, в данном случае +.

Именно здесь может быть полезна операция reduce (она представляет из себя абстракцию, которая несколько раз воплощает паттерн применения какой-либо другой операции)

Просуммировать все элементы потока данных можно следующим образом
```java
int sum = numbers.stream().reduce(0, (a, b) -> a + b);
```
Метод reduce применяет два аргумента:
- начальное значение, в данном случае 0
- оператор BinaryOperator, который группирует два элемента и выдает новое значение, в данном случае мы использовали лямда-выражение (a, b) -> a + b
![[Использование метода reduce для суммирования чисел из потока.png]]

Этот код можно сделать более лаконичным с помощью ссылки на метод. Начиная с Java 8, в классе Integer имеется метод sum, предназначенный для сложения двух чисел, который ГОРАЗДО более удобен по сравнению с написание лямда-выражения
Integer sum = numbers.stream().reduce(0, Integer::sum);

#### Вариант без начального значения.
Существует также перегруженный вариант метода reduce, не принимающий начального значения в качестве параметра и возвращающий Optional
```java
Optional<Integer> sum = numbers.stream().reduce((a, b) -> (a + b));
```
Почему он возвращает интерфейс Optional? Если поток данных не содержит элементом, операция reduce не может вернуть сумму, потому что начального значения нет. Именно поэтому результат обернут в объект Optional в качестве указания на то, что сумма может отсутсвовать.

## Максимум и минимум
Свертки достаточно для вычисления максимума и минимума!

Метод reduce принимает на вход два параметра:
- начальное значение
- лямбда-выражение, которое группирует два элемента потока данных в новое значение

Для вычисления максимального значения можно написать код так
```java
Optional<Integer> max = numbers.stream().reduce(Integer::max);
```
Для минимума
```java
Optional<Integer> max = numbers.stream().reduce(Integer::min);
```
Можно было бы написать лямбда-выражение
```java
(x, y) -> x < y ? x : y, вместо Integer::min
```
![[Операция recude - вычисление максимума.png]]

Пример, подсчитать число блюд в потоке данных с помощью методов map и reduce
```java
int count = menu.stream()
				.map(d -> 1)
				.reduce(0, (a, b) -> a + b);
```
Цепочка операций map и reduce широко известна под названием паттерна "Отображение-свертка (map-reduce)", легко распараллеливаемого.

Стоит отметить, что есть метод count, предназначенный для подсчета количества элементов в потоке данных
```java
long count = menu.stream().count();
```



__
### Zero-Links
- [[Работа с потоками данных]]
- [[Завершающие операции]]

__
### Links
- 

