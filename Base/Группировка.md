2022-10-0317:18
Tags: #Java #JavaCoreAdvanced #StreamAPI 

__
# Группировка
В БД часто встречается операция группировки элементов в некий набор на основе одного или нескольких свойств. 

В одном из ранних примеров про группировку транзакций по валюте, был написан код в императивном стиле, он плохо читаемый и в целом не очень, его можно переписать в функциональном.

Например, нужно классифицировать блюда в меню по типу: в одной группе - блюда с мясом, в другой - с рыбой, в третьей - все остальные. Можно легко решить эту задачу с помощью коллектора, возвращаемого фабричным методом Collectors.gropingBy
```java
Map<Dish.Type, List<Dish>> dishesByType = 
	menu.stream()
		.collect(groupingBy(Dish::getType));
```
В результате получается ассоциативный массив
```java
{FISH=[prawns, salmon], 
OTHER=[french fries, rice, season fruit, pizza],  
MEAT=[pork, beef, chicken]}
```
Здесь мы передаем в метод groupingBy экземпляр Function (в виде ссылки на метод), который извлекает соответсвующий Dish.Type из каждого объекта Dish потока. Этот объект Function называется *классификацией*, поскольку его задача состоит в классификации элементов потока данных по различным группам. 
![[Классификация элементов потока данных в процессе группировки.png]]
Ключ - тип блюда, значение - список всех блюд соотвествующего типа.

Но иногда ссылки на метод не подходят в качестве классификаций, ведь иногла простого извлечения свойства объекта для классификации недостаточно. 

Допустим, нужно классифицировать блюда как диетические (до 400 калорий), как обычные (от 400 до 700) и как жирные (от 700 калорий). Так как автор класса Dish не позаботился предоставить метод, реализующий подобную операци, воспользоваться ссылкой на метод в данном случае не получится, но можно использоваться лямбда-выражения!
```java
public enum CaloricLevel {DIET, NORMAL, FAT}
Map<CaloricLevel, List<Dish>> dishesByCaloricLevel = menu.stream()
	.collect(
		groupingBy(dish -> {
			if(dish.getCalories() <= 400) return CaloricLevel.DIET;
			else if(dish.getCalories() <= 700) return CaloricLevel.NORMAL;
			else return CaloricLevel.FAT;
			}));
```

Иногда нужно продолжить обработку результатов полученным группировкой. [[Дальнейшие операции со сгруппированными элементами]]
__
### Zero-Links
- [[Коллекторы как продвинутые средства свертки]]
- [[Сбор данных с помощью потоков данных]]
- [[Свертка и вычисление сводных показателей]]
- [[Дальнейшие операции со сгруппированными элементами]]

__
### Links
-  [[Многоуровневая группировка потока данных]]
- [[Сбор данных потока данных в подгруппы]]
- [[Секционирование]]


