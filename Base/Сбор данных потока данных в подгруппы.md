2022-10-0412:37
Tags: #Java #JavaCoreAdvanced #StreamAPI 

__
# Сбор данных в подгруппы
В общем случае, можно передавать в первый groupingBy коллектор произвольного типа, а не только еще один groupingBy. 

Например, можно подсчитать число блюд в меню для каждого из типов блюд, передав коллектор counting в качестве второго аргумента в коллектор counting
```java
Map<Dish.Type, Long> typesCount = menu.stream()
	.collect(
		groupingBy(Dish::getType,
			counting()));
```
Результат получаем такой
```java
{MEAT=3, FISH=2, OTHER=4}
```

Стоит отметить, что обычная операция groupingBy(f) с одним аргументом f - функцией классификации - является сокращенной записью от groupingBy(f, toList());

Например, переделаем коллектор, уже применявшийся для поиска самого калорийного блюда в меню, и получим аналогичный результат, только с классификацией по типу блюда
```java
Map<Dish.Type, Optional<Dish>> mostCaloricByType = 
	menu.stream()
		.collect(groupingBy(Dish::getType,
			maxBy(comparingInt(Dish::getCalories))));
```
В результате этой группировки получаем ассоциативный массив. Ключи которого - типы блюд, а значения - объекты Oprional(Dish), обертки для соответсвующих наиболее калорийных блюд в пределах данного типа.
```java
{FISH=Optional[salmon], 
OTHER=Optional[pizza], MEAT=Optional[pork]}
```

Значения в этом ассоциативном массиве служат объекты Oprional, так как имеено таков результат этого коллектора, генерируемого фабричным методом maxBy. Но при отсутсвии блюда данного типа в меню значение не будет равно Optional.empty(); в ассоциативном массиве вообще не будет ключа. Коллектор groupingBy добавляет новый ключ в итоговый массив отложенным образом - только тогда, когда обнаруживает первый элемент такого, что при применении к нему критерия группировки получается этот ключ. Иными словами. адаптер Optional не несет никакой пользы, так как не отражает факт возможного отсутсвия значения, он оказался здесь случайно, лишь потому, что коллектор свертки возвращает такой тип данных.

__
### Zero-Links
- [[Группировка]]
- [[Дальнейшие операции со сгруппированными элементами]]
- 

__
### Links
- [[Преобразование результатов работы коллектора к другому типу]]
- [[Другие примеры коллекторов, применяемых совместно с groupingBy]]

