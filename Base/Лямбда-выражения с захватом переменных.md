2022-09-0817:08
Tags: #Java #JavaCoreAdvanced 

__
# Лямбда-выражения с захватом переменных

- Внутри тела лямбда выражения могут применяться не только их параметры, но и *свободные переменные*, как в анонимных классах.
```java
//следующее лямбда-выражение захватывает переменную portNumber
int portNumber = 1337;
Runnable r = () -> System.out.println(portNumber);
```
- Здесть есть нюанс в виде списка ограничений того, что можно делать с этими переменными.
- Лямбда-выражения могут БЕЗ ограничений захватывать (чтобы ссылаться на них в своем теле) переменные экземпляра или статические переменные.
- НО захватываемые ЛОКАЛЬНЫЕ переменные должны быть явным образом объявлены как final или фактически являться таковыми. 
- Лямбда-выражения могут захватывать лишь локальные переменные, значение которых задается ОДНОКРАТНО.
```java
//Например, следующий код НЕ скомпилируется, поскольку переменной portNumber значение присваивается ДВАЖДЫ!

int portNumber = 1337;
Runnable r = () -> System.out.println(portNumber); 
portNumber = 31337;

//Ошибка: локальная переменная не объявлена final и фактически такой не является

```

- *Ограничения, налагаемые на локальные переменные*
Почему на лок. переменные накладываются такие ограничения? 
	Во-первых, существует клучевое различие во внутренний реализации переменных ЭКЗЕМПЛЯРА КЛАССА и ЛОКАЛЬНЫХ переменных. Переменных ЭКЗЕМПЛЯРА класса (объекта) хранятся в куче, в то время как ЛОКАЛЬНЫЕ переменные хранятся в стеке. Если бы лямбда могла обратиться к локальной переменной напрямую, причем использовалась в отдельном потоке выполнения, то этот поток мог бы попытаться обратиться к этой переменной после того, как поток, выделивший под неё память, освободит ресурсы. Поэтому доступ к свободной локальной переменной в Java реализован в виде доступа к её копии, а не к исходной переменной. Если присвоение значения переменной  выполняется лишь однократно, то никакой разницы нет - отсюда и возникает вышеописанное ограничение.
	Во-вторых, это ограничение также припятствует реализации типичных паттернов императивного программирования, связанных с изменением значения внешней переменной.
__
### Zero-Links
- [[00 Лямбда-выражения и Функциональные интерфейсы]]



